<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Devoluciones Pendientes</title>
  <style>
    /* === PALETA DE COLORES === */
    /* Define variables CSS (custom properties) para los colores principales del sitio. */
    :root {
      --yellow: #FFD700; /* Amarillo dorado */
      --gray-dark: #333333; /* Gris oscuro */
      --gray-light: #F2F2F2; /* Gris claro */
      --blue-strong: #0057B8; /* Azul fuerte */
      --white: #FFFFFF; /* Blanco */
      --black: #000000; /* Negro */
    }

    /* === ESTILOS GENERALES === */
    /* Aplica estilos a todos los elementos de la p치gina. */
    * {
      box-sizing: border-box; /* Incluye el padding y el border dentro del ancho y alto de un elemento. */
      margin: 0; /* Elimina el margen predeterminado de los elementos. */
      padding: 0; /* Elimina el relleno predeterminado de los elementos. */
      font-family: 'Segoe UI', sans-serif; /* Establece la fuente de texto predeterminada. */
    }

    /* Estilos para el elemento body (el cuerpo de la p치gina). */
    body {
      background-color: var(--gray-light); /* Establece el color de fondo usando la variable --gray-light. */
      padding: 2rem; /* A침ade un relleno de 2 rem alrededor del contenido del body. */
      color: var(--gray-dark); /* Establece el color de texto predeterminado usando la variable --gray-dark. */
    }

    /* === CONTENEDOR PRINCIPAL === */
    /* Estilos para el contenedor principal de la lista de devoluciones pendientes. */
    .container {
      max-width: 1000px; /* Establece un ancho m치ximo para el contenedor. */
      margin: auto; /* Centra el contenedor horizontalmente en la p치gina. */
      background-color: var(--white); /* Establece el color de fondo del contenedor en blanco. */
      padding: 2rem; /* A침ade un relleno de 2 rem dentro del contenedor. */
      border-radius: 20px; /* Redondea las esquinas del contenedor. */
      border: 2px solid var(--gray-dark); /* A침ade un borde gris oscuro al contenedor. */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* A침ade una sombra suave al contenedor. */
    }

    /* === BARRA SUPERIOR === */
    /* Estilos para la barra superior que contiene el bot칩n de "Atr치s" y el t칤tulo. */
    .top-bar {
      display: flex; /* Utiliza Flexbox para alinear los elementos horizontalmente. */
      align-items: center; /* Alinea verticalmente los elementos al centro. */
      justify-content: space-between; /* Distribuye el espacio entre los elementos. */
      margin-bottom: 2rem; /* A침ade un margen inferior para separar la barra del contenido principal. */
    }

    /* === BOTONES "ATR츼S" Y "DEVUELTOS DEL D칈A" === */
    /* Estilos comunes para los botones de "Atr치s" y "Devueltos del d칤a". */
    .back-button,
    .day-button {
      background-color: var(--yellow); /* Usa el color de fondo definido en --yellow. */
      border: none; /* Elimina el borde del bot칩n. */
      padding: 0.6rem 1.5rem; /* A침ade relleno vertical y horizontal al bot칩n. */
      font-weight: bold; /* Pone el texto del bot칩n en negrita. */
      font-size: 1rem; /* Establece el tama침o de la fuente del bot칩n. */
      border-radius: 10px; /* Redondea las esquinas del bot칩n. */
      box-shadow: 2px 2px 4px rgba(0,0,0,0.2); /* A침ade una sombra al bot칩n. */
      cursor: pointer; /* Cambia el cursor al pasar por encima, indicando que es interactivo. */
      transition: background 0.3s ease; /* A침ade una transici칩n suave para el cambio de color de fondo. */
    }

    /* Estilos para cuando se pasa el rat칩n por encima de los botones. */
    .back-button:hover,
    .day-button:hover {
      background-color: #e6c200; /* Un tono ligeramente m치s oscuro del amarillo al pasar el rat칩n. */
    }

    /* === T칈TULO PRINCIPAL === */
    /* Estilos para el t칤tulo principal de la p치gina (h1). */
    .title {
      text-align: center; /* Centra el texto del t칤tulo. */
      font-size: 2rem; /* Establece el tama침o de la fuente del t칤tulo. */
      flex-grow: 1; /* Permite que el t칤tulo ocupe el espacio restante en la barra superior. */
      color: var(--black); /* Usa el color del texto definido en --black. */
    }

    /* === BARRA DE B칔SQUEDA === */
    /* Estilos para la barra de b칰squeda de pr칠stamos pendientes. */
    .search-bar {
      margin: 0 auto 2rem; /* Centra la barra de b칰squeda horizontalmente y a침ade un margen inferior. */
      display: flex; /* Utiliza Flexbox para alinear elementos dentro de la barra de b칰squeda (aunque solo haya un input aqu칤). */
      justify-content: center; /* Centra el input dentro de la barra de b칰squeda. */
    }

    /* Estilos para el campo de entrada de la b칰squeda. */
    .search-input {
      width: 60%; /* Establece el ancho del campo de entrada al 60% de su contenedor. */
      padding: 0.6rem 1rem; /* A침ade relleno dentro del campo de entrada. */
      border: 2px solid var(--gray-dark); /* A침ade un borde gris oscuro al campo de entrada. */
      border-radius: 10px; /* Redondea las esquinas del campo de entrada. */
      font-size: 1rem; /* Establece el tama침o de la fuente dentro del campo de entrada. */
      background-color: var(--white); /* Establece el color de fondo del campo de entrada en blanco. */
      box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1); /* A침ade una sombra interior suave al campo de entrada. */
    }

    /* === CONTENEDOR DE TARJETAS EN GRILLA === */
    /* Estilos para el contenedor que organiza las tarjetas de pr칠stamos pendientes en una grilla. */
    .grid {
      display: grid; /* Utiliza la propiedad display grid para crear un dise침o de grilla. */
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); /* Define las columnas de la grilla para que se auto-ajusten con un ancho m칤nimo de 260px y m치ximo de 1fr (fracci칩n del espacio disponible). */
      gap: 1rem; /* Establece un espacio de 1 rem entre las celdas de la grilla (tanto filas como columnas). */
    }

    /* === TARJETA DE PR칄STAMO PENDIENTE === */
    /* Estilos para cada tarjeta que muestra la informaci칩n de un pr칠stamo pendiente. */
    .card {
      background-color: var(--blue-strong); /* Establece el color de fondo de la tarjeta en azul fuerte. */
      color: var(--white); /* Establece el color del texto dentro de la tarjeta en blanco. */
      border-radius: 16px; /* Redondea las esquinas de la tarjeta. */
      padding: 1rem; /* A침ade un relleno dentro de la tarjeta. */
      box-shadow: 0 2px 6px rgba(0,0,0,0.15); /* A침ade una sombra suave a la tarjeta. */
      position: relative; /* Establece la posici칩n como relativa para poder posicionar elementos absolutos dentro (como el bot칩n de "Devolver"). */
    }

    /* Estilos para los p치rrafos dentro de la tarjeta. */
    .card p {
      margin-bottom: 0.3rem; /* A침ade un peque침o margen inferior a los p치rrafos. */
    }

    /* Estilos para la informaci칩n de la cantidad del equipo pendiente. */
    .card .cantidad {
      text-align: right; /* Alinea el texto de la cantidad a la derecha. */
      font-weight: bold; /* Pone el texto de la cantidad en negrita. */
    }

    /* === BOT칍N "DEVOLVER" EN LA TARJETA === */
    /* Estilos para el bot칩n de "Devolver" dentro de cada tarjeta de pr칠stamo pendiente. */
    .card .btn-devolver {
      position: absolute; /* Posiciona el bot칩n de forma absoluta dentro de su contenedor relativo (.card). */
      top: 1rem; /* Lo coloca a 1 rem desde la parte superior de la tarjeta. */
      right: 1rem; /* Lo coloca a 1 rem desde la parte derecha de la tarjeta. */
      background-color: var(--yellow); /* Usa el color de fondo definido en --yellow. */
      color: var(--black); /* Establece el color del texto en negro. */
      border: none; /* Elimina el borde del bot칩n. */
      border-radius: 8px; /* Redondea las esquinas del bot칩n. */
      padding: 0.3rem 0.8rem; /* A침ade un peque침o relleno al bot칩n. */
      font-weight: bold; /* Pone el texto del bot칩n en negrita. */
      cursor: pointer; /* Cambia el cursor al pasar por encima. */
      box-shadow: 2px 2px 4px rgba(0,0,0,0.2); /* A침ade una sombra al bot칩n. */
      transition: background 0.3s ease; /* A침ade una transici칩n suave para el cambio de color de fondo. */
    }

    /* Estilo para cuando se pasa el rat칩n por encima del bot칩n "Devolver". */
    .card .btn-devolver:hover {
      background-color: #e6c200; /* Un tono ligeramente m치s oscuro del amarillo al pasar el rat칩n. */
    }

    /* === PIE DE P츼GINA === */
    /* Estilos para el pie de p치gina, que contiene el bot칩n de "Devueltos del d칤a". */
    .footer {
      text-align: right; /* Alinea el texto y los elementos del pie de p치gina a la derecha. */
      margin-top: 2rem; /* A침ade un margen superior para separar el pie de p치gina del contenido principal. */
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="top-bar">
      <button class="back-button" onclick="window.location.href='/prestamos'">Atr치s</button>

      <h1 class="title">Devoluciones Pendientes</h1>
    </div>

    <div class="search-bar">
      <input type="text" class="search-input" placeholder="游댌 Buscar" />
    </div>

    <!-- AQU칈 el ID CORRECTO -->
    <div class="grid" id="cards-container">
      <!-- Las tarjetas se generar치n din치micamente aqu칤 -->
    </div>
  </div>

  <script>
document.addEventListener("DOMContentLoaded", () => {
  const sesionId = localStorage.getItem("sesion_id");  // Aseg칰rate de haber guardado esto tras el login

  if (!sesionId) {
    alert("No se encontr칩 el ID de sesi칩n. Vuelve a iniciar sesi칩n.");
    return;
  }

  fetch(`/api/prestamos_pendientes/${sesionId}`)
    .then(response => response.json())
    .then(data => {
      if (!data.success) {
        throw new Error(data.message);
      }

      const container = document.getElementById("cards-container");
      container.innerHTML = "";

      data.data.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <button class="btn-devolver" data-id="${item.id}">Devolver</button>
          <p><strong>${item.nombre}</strong></p>
          <p>${item.matricula}</p>
          <p>${item.equipo}</p>
          <p class="cantidad">Cantidad: ${item.cantidad}</p>
        `;
        container.appendChild(card);
      });

      // Agrega listeners a todos los botones de devolver
      document.querySelectorAll(".btn-devolver").forEach(button => {
        button.addEventListener("click", () => {
          const prestamoId = button.getAttribute("data-id");

          fetch(`/api/devolver_prestamo/${prestamoId}`, {
            method: "POST"
          })
          .then(res => res.json())
          .then(result => {
            if (result.success) {
              // Elimina la tarjeta visualmente
              button.parentElement.remove();
            } else {
              alert("Error al marcar como devuelto: " + result.message);
            }
          })
          .catch(err => {
            console.error("Error en la solicitud de devoluci칩n:", err);
          });
        });
      });

    })
    .catch(error => {
      console.error("Error cargando pr칠stamos pendientes:", error);
    });
});
</script>

</body>
</html>

